---
title: "Workflow Schema"
icon: "diagram-project"
---

This document describes the complete YAML schema for Osmedeus workflows.

## Workflow Kinds

Osmedeus supports two workflow kinds:

| Kind | Description |
|------|-------------|
| `module` | Single execution unit with sequential/parallel steps |
| `flow` | Orchestrates multiple modules with dependencies |

## Workflow-Level Fields

### Common Fields (Both Module and Flow)

```yaml
kind: module|flow                    # Required: workflow type
name: string                         # Required: unique identifier
description: string                  # Optional: human-readable description
tags: string                         # Optional: comma-separated tags

params:                              # Optional: workflow parameters
  - name: string                     # Parameter identifier
    default: string                  # Default value
    required: bool                   # If true, workflow fails without it
    generator: string                # Auto-generate value (uuid(), currentDate(), etc.)

dependencies:                        # Optional: validate requirements
  commands: [string]                 # Binaries that must exist in PATH
  files: [string]                    # Files/directories that must exist
  variables:                         # Variable requirements
    - name: string
      type: domain|path|number|file|folder|string|subdomain|url|cidr|repo
      required: bool
  target_types: [string]             # Allowed target types
  functions_conditions: [string]     # JS expressions that must eval to true

reports:                             # Optional: define output files
  - name: string                     # Display name
    path: string                     # File path (supports templates)
    type: text|csv|json|markdown     # Format type
    description: string              # Human-readable description

trigger:                             # Optional: execution triggers
  - name: string
    on: cron|event|watch|manual
    enabled: bool
    schedule: string                 # Cron expression (for cron)
    event:                           # Event configuration
      topic: string                  # e.g., "webhook.received"
      filters: [string]              # JS expressions for filtering
    path: string                     # Watch path (for watch)
    input:                           # Input source for trigger
      type: file|event_data|function|param
      path: string
      field: string
      function: string
      name: string

preferences:                         # Optional: execution preferences
  disable_notifications: bool
  disable_logging: bool
  heuristics_check: none|basic|advanced
  ci_output_format: bool
  silent: bool
  repeat: bool
  repeat_wait_time: string           # e.g., "60s", "1h"
```

### Module-Specific Fields

```yaml
runner: host|docker|ssh              # Execution environment (default: host)

runner_config:                       # Runner configuration
  # Docker configuration
  image: string                      # Docker image
  env: map[string]string             # Environment variables
  volumes: [string]                  # Volume mounts
  network: string                    # Network mode
  persistent: bool                   # Reuse container

  # SSH configuration
  host: string                       # SSH hostname
  port: int                          # SSH port (default: 22)
  user: string                       # SSH username
  key_file: string                   # Path to SSH key
  password: string                   # SSH password

  # Common
  workdir: string                    # Working directory

steps: [Step]                        # Ordered execution steps
```

### Flow-Specific Fields

```yaml
modules:                             # Module references to execute
  - name: string                     # Display name (required)
    path: string                     # Path to module YAML (required)
    params: map[string]string        # Parameter overrides
    depends_on: [string]             # Module dependencies
    condition: string                # JS expression for conditional execution
    on_success: [Action]             # Success handlers
    on_error: [Action]               # Error handlers
    decision:                        # Conditional routing
      switch: string
      cases: map[string]{goto: string}
      default: {goto: string}
```

## Step Definitions

All steps share common fields:

```yaml
name: string                         # Required: step identifier
type: string                         # Required: step type
pre_condition: string                # Optional: JS expression
log: string                          # Optional: custom log message
timeout: int|string                  # Optional: max execution time
exports: map[string]string           # Optional: variable exports
on_success: [Action]                 # Optional: success handlers
on_error: [Action]                   # Optional: error handlers
decision:                            # Optional: conditional routing
  switch: string
  cases: map[string]{goto: string}
  default: {goto: string}
```

### Step Type: bash

Execute shell commands.

```yaml
type: bash
command: string                      # Single command
commands: [string]                   # Sequential commands
parallel_commands: [string]          # Concurrent commands
std_file: string                     # Save stdout/stderr to file

# Structured argument fields (joined as command + args)
speed_args: string                   # Performance arguments
config_args: string                  # Configuration arguments
input_args: string                   # Input arguments
output_args: string                  # Output arguments
```

### Step Type: function

Execute utility functions.

```yaml
type: function
function: string                     # Single function call
functions: [string]                  # Sequential function calls
parallel_functions: [string]         # Concurrent function calls
```

### Step Type: parallel-steps

Execute steps concurrently.

```yaml
type: parallel-steps
parallel_steps: [Step]               # Steps executed in parallel
```

### Step Type: foreach

Iterate over input items.

```yaml
type: foreach
input: string                        # File path or content (one item per line)
variable: string                     # Loop variable name (use [[variable]])
threads: int|string                  # Concurrent iterations (default: 1)
step: Step                           # Inner step for each item
```

### Step Type: remote-bash

Execute commands via Docker or SSH.

```yaml
type: remote-bash
step_runner: docker|ssh              # Required: execution environment

step_runner_config:                  # Optional: runner configuration
  image: string                      # For docker
  host: string                       # For ssh
  user: string                       # For ssh
  port: int                          # For ssh
  key_file: string                   # For ssh
  password: string                   # For ssh
  env: map[string]string
  volumes: [string]
  workdir: string

command: string                      # Single command
commands: [string]                   # Sequential commands
parallel_commands: [string]          # Concurrent commands
step_remote_file: string             # Remote file to copy after execution
host_output_file: string             # Local destination for remote file
```

### Step Type: http

Make HTTP requests.

```yaml
type: http
url: string                          # Required: target URL
method: string                       # HTTP method (GET, POST, PUT, DELETE, PATCH)
headers: map[string]string           # HTTP headers
request_body: string                 # Request body
timeout: int                         # Max execution time (seconds)
```

### Step Type: llm

Interact with LLM providers.

```yaml
type: llm
messages:                            # Chat messages
  - role: system|user|assistant|tool
    content: string|[ContentPart]
    name: string                     # For tool role
    tool_call_id: string             # For tool role
    tool_calls: [ToolCall]           # Tool calls by LLM

tools:                               # Available function tools
  - type: function
    function:
      name: string
      description: string
      parameters: object             # JSON Schema

tool_choice: auto|none|required|object

llm_config:                          # Step-level configuration
  provider: string
  model: string
  max_tokens: int
  temperature: float64
  top_k: int
  top_p: float64
  n: int
  timeout: string
  max_retries: int
  stream: bool
  response_format:
    type: text|json_object|json_schema
    json_schema: object

extra_llm_parameters: map[string]any # Provider-specific parameters

is_embedding: bool                   # Embedding request flag
embedding_input: [string]            # Texts for embeddings
```

## Decision Routing

Conditional branching using switch/case syntax:

```yaml
decision:
  switch: "{{variable}}"             # Variable to match
  cases:
    "value1":
      goto: step-name-a
    "value2":
      goto: step-name-b
  default:
    goto: fallback-step              # Or "_end" to terminate
```

## Actions

Available for `on_success` and `on_error` handlers:

```yaml
on_success:
  - action: log|abort|continue|export|run|notify
    message: string                  # Log or error message
    condition: string                # Optional: JS expression

    # For export action
    name: string                     # Variable name
    value: any                       # Value to export

    # For run action
    type: bash|function
    command: string                  # For bash
    functions: [string]              # For function
    export: map[string]string        # Result mapping

    # For notify action
    notify: string                   # Notification message
```

**Action Types:**
- `log` - Log a message
- `abort` - Stop workflow execution
- `continue` - Continue despite error
- `export` - Export variable for subsequent steps
- `run` - Execute follow-up step
- `notify` - Send notification

## Timeout Formats

```yaml
timeout: 60                          # Seconds as integer
timeout: "30s"                       # Duration string
timeout: "1h30m"                     # Hours and minutes
timeout: "2d"                        # Days
```

## Examples

### Simple Module

```yaml
kind: module
name: basic-scan
description: Simple security scanning module

params:
  - name: target
    required: true

steps:
  - name: scan
    type: bash
    command: echo "Scanning {{Target}}"
    exports:
      scan_result: completed
```

### Module with Multiple Step Types

```yaml
kind: module
name: complex-workflow
description: Demonstrates multiple step types

steps:
  - name: setup
    type: bash
    command: mkdir -p {{Output}}

  - name: parallel-processing
    type: parallel-steps
    parallel_steps:
      - name: task-a
        type: bash
        command: echo "Task A"
      - name: task-b
        type: function
        function: log_info("Task B")

  - name: iterate
    type: foreach
    input: "{{Output}}/items.txt"
    variable: item
    step:
      type: bash
      command: echo "Processing [[item]]"

  - name: branch
    type: bash
    command: echo "branching"
    decision:
      switch: "{{scan_result}}"
      cases:
        "success": {goto: final-step}
      default: {goto: _end}

  - name: final-step
    type: function
    function: log_info("Done")
```

### Flow with Module Dependencies

```yaml
kind: flow
name: full-assessment
description: Complete security assessment flow

modules:
  - name: reconnaissance
    path: modules/recon.yaml
    params:
      threads: "20"

  - name: scanning
    path: modules/scan.yaml
    depends_on:
      - reconnaissance

  - name: reporting
    path: modules/report.yaml
    depends_on:
      - scanning
    condition: 'fileExists("{{Output}}/scan-results.txt")'
```
